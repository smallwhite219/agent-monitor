// Pixel sprite color data — 16x16 grids
// null = transparent, hex string = fill color

const _ = null;

// Developer — blue hoodie, headphones
export const DEV_SPRITE = [
    [_, _, _, _, _, _, '#333', '#333', '#333', '#333', _, _, _, _, _, _],
    [_, _, _, _, _, '#333', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#333', _, _, _, _, _],
    [_, _, _, _, '#333', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#333', _, _, _, _],
    [_, _, _, '#555', '#FFD5B0', '#3C2415', _, '#FFD5B0', '#FFD5B0', _, '#3C2415', '#FFD5B0', '#555', _, _, _],
    [_, _, _, '#555', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#555', _, _, _],
    [_, _, _, _, '#FFD5B0', '#FFD5B0', '#FFD5B0', '#E8967A', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _],
    [_, _, _, _, _, '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', _, _, _, _, _],
    [_, _, _, _, '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', _, _, _, _],
    [_, _, _, '#3B82F6', '#3B82F6', '#3B82F6', '#2563EB', '#2563EB', '#2563EB', '#2563EB', '#3B82F6', '#3B82F6', '#3B82F6', _, _, _],
    [_, _, _, '#FFD5B0', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#FFD5B0', _, _, _],
    [_, _, _, '#FFD5B0', _, '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', _, '#FFD5B0', _, _, _],
    [_, _, _, _, _, _, '#3B82F6', '#3B82F6', '#3B82F6', '#3B82F6', _, _, _, _, _, _],
    [_, _, _, _, _, _, '#444', '#444', '#444', '#444', _, _, _, _, _, _],
    [_, _, _, _, _, '#444', '#444', _, _, '#444', '#444', _, _, _, _, _],
    [_, _, _, _, '#444', '#444', _, _, _, _, '#444', '#444', _, _, _, _],
    [_, _, _, _, '#333', '#333', _, _, _, _, '#333', '#333', _, _, _, _],
];

// Designer — pink beret, purple top
export const DESIGN_SPRITE = [
    [_, _, _, _, _, '#E879A0', '#E879A0', '#E879A0', '#E879A0', '#E879A0', '#E879A0', _, _, _, _, _],
    [_, _, _, _, '#E879A0', '#E879A0', '#E879A0', '#E879A0', '#E879A0', '#E879A0', '#E879A0', '#E879A0', _, _, _, _],
    [_, _, _, _, _, '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _, _],
    [_, _, _, _, '#FFD5B0', '#3C2415', _, '#FFD5B0', '#FFD5B0', _, '#3C2415', '#FFD5B0', _, _, _, _],
    [_, _, _, _, '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _],
    [_, _, _, _, _, '#FFD5B0', '#FFD5B0', '#E8967A', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _, _],
    [_, _, _, _, _, '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', _, _, _, _, _],
    [_, _, _, _, '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', _, _, _, _],
    [_, _, _, '#8B5CF6', '#8B5CF6', '#8B5CF6', '#7C3AED', '#7C3AED', '#7C3AED', '#7C3AED', '#8B5CF6', '#8B5CF6', '#8B5CF6', _, _, _],
    [_, _, _, '#FFD5B0', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#FFD5B0', _, _, _],
    [_, _, _, '#FFD5B0', _, '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', _, '#FFD5B0', _, _, _],
    [_, _, _, _, _, _, '#8B5CF6', '#8B5CF6', '#8B5CF6', '#8B5CF6', _, _, _, _, _, _],
    [_, _, _, _, _, _, '#444', '#444', '#444', '#444', _, _, _, _, _, _],
    [_, _, _, _, _, '#444', '#444', _, _, '#444', '#444', _, _, _, _, _],
    [_, _, _, _, '#444', '#444', _, _, _, _, '#444', '#444', _, _, _, _],
    [_, _, _, _, '#333', '#333', _, _, _, _, '#333', '#333', _, _, _, _],
];

// Manager — tie, glasses
export const PM_SPRITE = [
    [_, _, _, _, _, _, '#3C2415', '#3C2415', '#3C2415', '#3C2415', _, _, _, _, _, _],
    [_, _, _, _, _, '#3C2415', '#3C2415', '#3C2415', '#3C2415', '#3C2415', '#3C2415', _, _, _, _, _],
    [_, _, _, _, _, '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _, _],
    [_, _, _, _, '#FFD5B0', '#222', '#60A5FA', '#FFD5B0', '#FFD5B0', '#60A5FA', '#222', '#FFD5B0', _, _, _, _],
    [_, _, _, _, '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _],
    [_, _, _, _, _, '#FFD5B0', '#FFD5B0', '#E8967A', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _, _],
    [_, _, _, _, _, '#E5E7EB', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#E5E7EB', _, _, _, _, _],
    [_, _, _, _, '#E5E7EB', '#E5E7EB', '#E5E7EB', '#DC2626', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#E5E7EB', _, _, _, _],
    [_, _, _, '#555', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#DC2626', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#555', _, _, _],
    [_, _, _, '#FFD5B0', '#555', '#E5E7EB', '#E5E7EB', '#DC2626', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#555', '#FFD5B0', _, _, _],
    [_, _, _, '#FFD5B0', _, '#555', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#E5E7EB', '#555', _, '#FFD5B0', _, _, _],
    [_, _, _, _, _, _, '#555', '#555', '#555', '#555', _, _, _, _, _, _],
    [_, _, _, _, _, _, '#333', '#333', '#333', '#333', _, _, _, _, _, _],
    [_, _, _, _, _, '#333', '#333', _, _, '#333', '#333', _, _, _, _, _],
    [_, _, _, _, '#333', '#333', _, _, _, _, '#333', '#333', _, _, _, _],
    [_, _, _, _, '#222', '#222', _, _, _, _, '#222', '#222', _, _, _, _],
];

// Security — dark hoodie, shield emblem
export const SECURITY_SPRITE = [
    [_, _, _, _, _, _, '#1A1A2E', '#1A1A2E', '#1A1A2E', '#1A1A2E', _, _, _, _, _, _],
    [_, _, _, _, _, '#1A1A2E', '#1A1A2E', '#1A1A2E', '#1A1A2E', '#1A1A2E', '#1A1A2E', _, _, _, _, _],
    [_, _, _, _, _, '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _, _],
    [_, _, _, _, '#FFD5B0', '#111', _, '#FFD5B0', '#FFD5B0', _, '#111', '#FFD5B0', _, _, _, _],
    [_, _, _, _, '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _],
    [_, _, _, _, _, '#FFD5B0', '#FFD5B0', '#C08060', '#FFD5B0', '#FFD5B0', '#FFD5B0', _, _, _, _, _],
    [_, _, _, _, _, '#1F2937', '#1F2937', '#1F2937', '#1F2937', '#1F2937', '#1F2937', _, _, _, _, _],
    [_, _, _, _, '#1F2937', '#1F2937', '#1F2937', '#10B981', '#1F2937', '#1F2937', '#1F2937', '#1F2937', _, _, _, _],
    [_, _, _, '#1F2937', '#1F2937', '#1F2937', '#10B981', '#10B981', '#10B981', '#1F2937', '#1F2937', '#1F2937', '#1F2937', _, _, _],
    [_, _, _, '#FFD5B0', '#1F2937', '#1F2937', '#1F2937', '#10B981', '#1F2937', '#1F2937', '#1F2937', '#1F2937', '#FFD5B0', _, _, _],
    [_, _, _, '#FFD5B0', _, '#1F2937', '#1F2937', '#1F2937', '#1F2937', '#1F2937', '#1F2937', _, '#FFD5B0', _, _, _],
    [_, _, _, _, _, _, '#1F2937', '#1F2937', '#1F2937', '#1F2937', _, _, _, _, _, _],
    [_, _, _, _, _, _, '#333', '#333', '#333', '#333', _, _, _, _, _, _],
    [_, _, _, _, _, '#333', '#333', _, _, '#333', '#333', _, _, _, _, _],
    [_, _, _, _, '#222', '#222', _, _, _, _, '#222', '#222', _, _, _, _],
    [_, _, _, _, '#111', '#111', _, _, _, _, '#111', '#111', _, _, _, _],
];

export const AGENT_SPRITES = {
    dev: DEV_SPRITE,
    design: DESIGN_SPRITE,
    pm: PM_SPRITE,
    security: SECURITY_SPRITE,
};

// ── Dynamic sprite generation ───────────────────────────────────────
function hashStr(str) {
    let h = 0;
    for (let i = 0; i < str.length; i++) {
        h = ((h << 5) - h + str.charCodeAt(i)) | 0;
    }
    return Math.abs(h);
}

function hsl(h, s, l) {
    s /= 100; l /= 100;
    const a = s * Math.min(l, 1 - l);
    const f = n => {
        const k = (n + h / 30) % 12;
        const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
        return Math.round(255 * color).toString(16).padStart(2, '0');
    };
    return `#${f(0)}${f(8)}${f(4)}`;
}

const ROLE_PALETTES = {
    engineering: { primary: 210, secondary: 220 },
    'ui/ux': { primary: 280, secondary: 320 },
    coordination: { primary: 30, secondary: 40 },
    safety: { primary: 160, secondary: 170 },
    design: { primary: 300, secondary: 330 },
    testing: { primary: 50, secondary: 60 },
    devops: { primary: 180, secondary: 190 },
    research: { primary: 260, secondary: 270 },
};

function getRolePalette(role, id) {
    const key = (role || '').toLowerCase();
    for (const [k, v] of Object.entries(ROLE_PALETTES)) {
        if (key.includes(k)) return v;
    }
    const h = hashStr(id) % 360;
    return { primary: h, secondary: (h + 30) % 360 };
}

const HAIR_STYLES = [
    (c) => [
        [_, _, _, _, _, _, c, c, c, c, _, _, _, _, _, _],
        [_, _, _, _, _, c, c, c, c, c, c, _, _, _, _, _],
    ],
    (c) => [
        [_, _, _, _, _, c, c, c, c, c, c, _, _, _, _, _],
        [_, _, _, _, c, c, c, c, c, c, c, c, _, _, _, _],
    ],
    (c) => [
        [_, _, _, _, c, c, c, c, c, c, c, _, _, _, _, _],
        [_, _, _, c, c, c, c, c, c, c, c, c, _, _, _, _],
    ],
    (c) => [
        [_, _, _, _, _, _, _, c, c, _, _, _, _, _, _, _],
        [_, _, _, _, _, c, c, c, c, c, c, _, _, _, _, _],
    ],
];

const SKIN_TONES = ['#FFD5B0', '#E8B88A', '#C68B59', '#8D5524', '#FFDBAC'];
const HAIR_COLORS = ['#3C2415', '#1A1A2E', '#8B4513', '#D4A03B', '#C0392B', '#555', '#E06060'];

export function generateSprite(id, role = '') {
    const h = hashStr(id);
    const palette = getRolePalette(role, id);
    const skin = SKIN_TONES[h % SKIN_TONES.length];
    const hair = HAIR_COLORS[(h >> 4) % HAIR_COLORS.length];
    const hairStyle = HAIR_STYLES[(h >> 8) % HAIR_STYLES.length];
    const shirtMain = hsl(palette.primary, 65, 55);
    const shirtDark = hsl(palette.primary, 65, 40);
    const accent = hsl(palette.secondary, 70, 60);
    const pants = '#444';
    const shoes = '#333';

    return [
        ...hairStyle(hair),
        [_, _, _, _, _, skin, skin, skin, skin, skin, skin, _, _, _, _, _],
        [_, _, _, _, skin, '#222', _, skin, skin, _, '#222', skin, _, _, _, _],
        [_, _, _, _, skin, skin, skin, skin, skin, skin, skin, skin, _, _, _, _],
        [_, _, _, _, _, skin, skin, '#C08060', skin, skin, skin, _, _, _, _, _],
        [_, _, _, _, _, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, _, _, _, _, _],
        [_, _, _, _, shirtMain, shirtMain, shirtMain, accent, shirtMain, shirtMain, shirtMain, shirtMain, _, _, _, _],
        [_, _, _, shirtMain, shirtMain, shirtMain, shirtDark, shirtDark, shirtDark, shirtDark, shirtMain, shirtMain, shirtMain, _, _, _],
        [_, _, _, skin, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, skin, _, _, _],
        [_, _, _, skin, _, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, shirtMain, _, skin, _, _, _],
        [_, _, _, _, _, _, shirtMain, shirtMain, shirtMain, shirtMain, _, _, _, _, _, _],
        [_, _, _, _, _, _, pants, pants, pants, pants, _, _, _, _, _, _],
        [_, _, _, _, _, pants, pants, _, _, pants, pants, _, _, _, _, _],
        [_, _, _, _, pants, pants, _, _, _, _, pants, pants, _, _, _, _],
        [_, _, _, _, shoes, shoes, _, _, _, _, shoes, shoes, _, _, _, _],
    ];
}

export function getSpriteForAgent(id, role) {
    return AGENT_SPRITES[id] || generateSprite(id, role);
}
